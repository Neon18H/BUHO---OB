{% extends 'ui/base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div><h1 class="h3 mb-0">Overview</h1><small class="text-body-secondary">Datos reales de agentes Buho.</small></div>
</div>
<form method="get" class="row g-2 mb-3">
  <div class="col-md-3"><select class="form-select" name="agent">{% for agent in agents %}<option value="{{ agent.id }}" {% if selected_agent and selected_agent.id == agent.id %}selected{% endif %}>{{ agent.name }}</option>{% endfor %}</select></div>
  <div class="col-md-2"><select class="form-select" name="provider"><option value="">Provider</option>{% for key,label in providers %}<option value="{{ key }}" {% if filters.provider == key %}selected{% endif %}>{{ label }}</option>{% endfor %}</select></div>
  <div class="col-md-2"><select class="form-select" name="env"><option value="">Env</option>{% for key,label in envs %}<option value="{{ key }}" {% if filters.env == key %}selected{% endif %}>{{ label }}</option>{% endfor %}</select></div>
  <div class="col-md-2"><input class="form-control" name="tag" value="{{ filters.tag }}" placeholder="tag"></div>
  <div class="col-md-2"><select class="form-select" name="time_range"><option value="15m" {% if filters.time_range == '15m' %}selected{% endif %}>15m</option><option value="1h" {% if filters.time_range == '1h' %}selected{% endif %}>1h</option><option value="24h" {% if filters.time_range == '24h' %}selected{% endif %}>24h</option></select></div>
  <div class="col-md-1"><button class="btn btn-primary w-100">Go</button></div>
</form>
<div class="row g-3 mb-4">{% for kpi in kpi_cards %}<div class="col-sm-6 col-xl-4">{% include 'ui/components/kpi_card.html' with icon=kpi.icon title=kpi.title value=kpi.value %}</div>{% endfor %}</div>
<div class="row g-3"><div class="col-lg-6">{% include 'ui/components/chart_card.html' with title='CPU / RAM' chart_id='cpuRamChart' %}</div><div class="col-lg-6">{% include 'ui/components/chart_card.html' with title='Network In / Out' chart_id='networkChart' %}</div></div>
<div class="card mt-3 p-3"><h6>Top offenders</h6><ul class="mb-0">{% for item in top_offenders %}<li>{{ item.name }} · health {{ item.health_score }} · {{ item.get_provider_display }}</li>{% empty %}<li>Sin datos</li>{% endfor %}</ul></div>
{% endblock %}
{% block scripts %}<script>
new Chart(document.getElementById('cpuRamChart'), {type:'line', data:{labels:{{ cpu_labels|safe }},datasets:[{label:'CPU %',data:{{ cpu_values|safe }},borderColor:'#4f46e5',tension:.35},{label:'RAM %',data:{{ ram_values|safe }},borderColor:'#06b6d4',tension:.35}]}});
new Chart(document.getElementById('networkChart'), {type:'line', data:{labels:{{ cpu_labels|safe }},datasets:[{label:'In',data:{{ net_in|safe }},borderColor:'#16a34a'},{label:'Out',data:{{ net_out|safe }},borderColor:'#f97316'}]}});
</script>{% endblock %}

{% extends 'ui/base_noc.html' %}
{% block breadcrumbs %}Agents / Overview{% endblock %}
{% block content %}
<div class="glass p-4 mb-4">
  <h1 class="text-xl mb-3">Agents Overview</h1>
  <form class="grid md:grid-cols-4 gap-3">
    <select name="provider" class="bg-slate-900 border border-slate-700 rounded px-2 py-2"><option value="">Provider</option>{% for key,label in providers %}<option value="{{ key }}">{{ label }}</option>{% endfor %}</select>
    <select name="env" class="bg-slate-900 border border-slate-700 rounded px-2 py-2"><option value="">OS / Env</option>{% for key,label in envs %}<option value="{{ key }}">{{ label }}</option>{% endfor %}</select>
    <input name="q" placeholder="Search" class="bg-slate-900 border border-slate-700 rounded px-2 py-2">
    <button class="btn-noc btn-primary-noc">Filter</button>
  </form>
</div>
<div class="glass p-4 mb-4">
<table class="table-noc"><thead><tr><th>Hostname</th><th>Provider</th><th>OS</th><th>Last Seen</th><th>Status</th><th>Version</th><th>Actions</th></tr></thead><tbody>
{% for agent in agents %}<tr><td>{{ agent.hostname }}</td><td>{{ agent.get_provider_display }}</td><td>{{ agent.os }}</td><td>{{ agent.last_seen|date:'Y-m-d H:i:s' }}</td><td><span class="badge-noc {% if agent.status == 'ONLINE' %}badge-online{% else %}badge-offline{% endif %}">{{ agent.status }}</span></td><td>{{ agent.version }}</td><td class="space-x-2"><a href="{% url 'agents:detail' agent.id %}">View</a><a href="{% url 'agents:install' %}">Install</a><a href="{% url 'agents:tokens' %}">Generate Token</a></td></tr>{% empty %}<tr><td colspan="7">Waiting for agent telemetry</td></tr>{% endfor %}
</tbody></table>
</div>
<div class="glass p-4">
  <div class="flex items-center justify-between mb-3">
    <h2 class="text-lg">Windows Troubleshooting</h2>
    <button type="button" class="btn-noc" onclick="document.getElementById('local-log-help').classList.toggle('hidden')">View local logs instructions</button>
  </div>
  <div id="local-log-help" class="hidden space-y-2 text-sm text-slate-300">
    <p><strong>Task status</strong></p>
    <pre class="bg-slate-900 border border-slate-700 rounded p-2">schtasks /Query /TN "BuhoAgent" /V /FO LIST</pre>
    <p><strong>Agent logs</strong></p>
    <pre class="bg-slate-900 border border-slate-700 rounded p-2">Get-Content "C:\ProgramData\BuhoAgent\buho-agent.log" -Tail 200 -Wait</pre>
    <p><strong>Manual repair</strong></p>
    <pre class="bg-slate-900 border border-slate-700 rounded p-2">& "C:\ProgramData\BuhoAgent\venv\Scripts\python.exe" "C:\ProgramData\BuhoAgent\agent.py" --run --config "C:\ProgramData\BuhoAgent\config.json"</pre>
  </div>
</div>
{% endblock %}

{% extends 'ui/base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div><h1 class="h3 mb-1">Agentes</h1><p class="text-body-secondary mb-0">Segmentación por provider/env con health score.</p></div>
  <div class="d-flex gap-2"><a href="{% url 'agents:install' %}" class="btn btn-primary"><i class="bi bi-plug"></i> Instalar agente</a>{% if can_manage_tokens %}<a href="{% url 'agents:tokens' %}" class="btn btn-outline-secondary">Tokens</a>{% endif %}</div>
</div>
<form class="row g-2 mb-3" method="get">
  <div class="col-md-4"><select class="form-select" name="provider"><option value="">Provider</option>{% for k,l in providers %}<option value="{{ k }}" {% if filters.provider == k %}selected{% endif %}>{{ l }}</option>{% endfor %}</select></div>
  <div class="col-md-4"><select class="form-select" name="env"><option value="">Env</option>{% for k,l in envs %}<option value="{{ k }}" {% if filters.env == k %}selected{% endif %}>{{ l }}</option>{% endfor %}</select></div>
  <div class="col-md-4"><button class="btn btn-primary w-100">Filtrar</button></div>
</form>
<div class="row g-3 mb-3"><div class="col-md-4">{% include 'ui/components/kpi_card.html' with icon='bi-wifi' title='Online' value=online_count variant='success' %}</div><div class="col-md-4">{% include 'ui/components/kpi_card.html' with icon='bi-wifi-off' title='Offline' value=offline_count variant='danger' %}</div><div class="col-md-4">{% include 'ui/components/kpi_card.html' with icon='bi-exclamation-triangle' title='Degraded' value=degraded_count variant='warning' %}</div></div>
<div class="card table-card"><div class="table-responsive"><table class="table align-middle mb-0"><thead><tr><th>Nombre</th><th>Provider</th><th>Env</th><th>Health</th><th>Estado</th><th>Last seen</th><th></th></tr></thead><tbody>{% for agent in agents %}<tr><td>{{ agent.name }}</td><td>{{ agent.get_provider_display }}</td><td>{{ agent.get_environment_display }}</td><td>{{ agent.health_score }}</td><td>{{ agent.get_status_display }}</td><td>{{ agent.last_seen|date:'Y-m-d H:i'|default:'-' }}</td><td><a class="btn btn-sm btn-outline-primary" href="{% url 'agents:detail' agent.id %}">Ver detalle</a></td></tr>{% empty %}<tr><td colspan="7">{% include 'ui/components/empty_state.html' with title='Sin agentes aún' body='Genera un token e instala el agente para comenzar.' icon='bi-robot' %}</td></tr>{% endfor %}</tbody></table></div></div>
{% endblock %}
